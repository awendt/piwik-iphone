<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>piwik + jQTouch</title>
    <link type="text/css" rel="stylesheet" href="visualize.jQuery.css"/>
    <link type="text/css" rel="stylesheet" href="jqtouch/jqtouch.min.css"/>
    <link type="text/css" rel="stylesheet" href="jqtouch/apple-theme/theme.min.css"/>
    <style type="text/css">
      .loading {
        background: url(jqtouch/apple-theme/img/loading.gif) no-repeat 50% center;
        height:50px;
      }
      #visits {
        margin:20px auto;
        width:480px;
      }
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" />
    <!--[if IE]><script type="text/javascript" src="excanvas.compiled.js"></script><![endif]-->
    <script type="text/javascript" src="jqtouch/all.js" ></script>
    <script type="text/javascript">
      var jQT = new $.jQTouch({
        icon: 'jqtouch.png',
        slideSelector: 'body > * > ul li a, .forceSlide',
        addGlossToIcon: false,
        startupScreen: 'jqt_startup.png',
        statusBar: 'black',
        preloadImages: [
          'jqtouch/apple-theme/img/backButton.png',
          'jqtouch/apple-theme/img/grayButton.png',
          'jqtouch/apple-theme/img/whiteButton.png',
          'jqtouch/apple-theme/img/loading.gif'
          ]
      });
      $(function(){
        $('#querySites').click(function() {
          if ($("#install").val() === "") { return; }

          $.getJSON($("#install").val() +
"/?module=API&method=SitesManager.getSitesWithViewAccess&format=json&token_auth="+$("#token").val()+"&jsoncallback=?", function(json) {
            // $("#loading").remove();
            // $(".question2").after('<label for="site">Please choose a site:</label><select id="site" name="site" size="1"></select>');
            $.each(json, function(key, site) {
              $("#site").append('<option value="'+ site.idsite +'">'+ site.name +'</option>');
            });
            $(".question3").show();
            $('#querySites').hide();
          });
        });

        $("#graph_screen").bind('pageAnimationEnd', function() {
        // $("#queryVisits").click(function() {
$.getJSON($("#install").val()+"/?module=API&method=VisitsSummary.getVisits&idSite="+$("#site").val()+"&period=day&date=last10&format=json&token_auth="+$("#token").val()+"&jsoncallback=?", function(json) {
            $.each(json, function(key, value) {
              $('#visits tbody').append("<tr><th>"+key+"</th><td>"+value+"</td></tr>")
            });
            // $("#visits").show();
            $("#graph_screen .loading").hide();
            $("#visits").visualize({type: 'area', parseDirection: 'y', appendKey: false, appendTitle: false});
            // var permalink = document.location;
            // permalink += '?token='+$("#token").val();
            // permalink += '&site='+$("#site").val();
            // permalink += '&install='+url($("#install").val());
            // $("input[type=submit]").after('<a href="'+ permalink +'">Permalink for this setup</a>');
            // $('<a href="#graph_screen" class="slide" />').click();
          });
        });
      });
    </script>
    <style type="text/css" media="screen">
      body.fullscreen #home .info {
          display: none;
      }
      #about {
          padding: 100px 10px 40px;
          text-shadow: rgba(255, 255, 255, 0.3) 0px -1px 0;
          font-size: 13px;
          text-align: center;
          background: #161618;
      }
      #about p {
          margin-bottom: 8px;
      }
      #about a {
          color: #fff;
          font-weight: bold;
          text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div id="graph_screen">
      <div class="toolbar">
        <h1>Visits last 10 days</h1>
        <a class="back" href="#home">Back</a>
      </div>
      <ul class="edit rounded">
        <div class="loading">
        </div>
        <table id="visits" style="display:none;">
          <caption>Besucher der letzten 10 Tage</captions>
          <thead>
            <tr>
              <td></td>
              <th>Besucher</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </ul>
    </div>
    <div id="home" class="current">
      <div class="toolbar">
        <h1>piwik + jQTouch</h1>
      </div>
      <form>
        <h2>Where is your Piwik installation hosted?</h2>
        <ul class="edit rounded question1">
          <li><input type="text" name="install" value="http://piwik.org/demo" id="install" /></li>
        </ul>
        <h2>Please provide a token for a user with read access:</h2>
        <ul class="edit rounded question2">
          <li><input type="text" name="token" placeholder="32-char hash" id="token" /></li>
        </ul>
        <a href="#" id="querySites" style="margin:10px;" class="whiteButton submit">Show sites</a>
        <div style="display:none;" class="question3">
          <h2>Please choose a site:</h2>
          <ul class="edit rounded">
            <li>
              <select id="site">
              </select>
            </li>
          </ul>
          <a href="#graph_screen" class="whiteButton submit forceSlide" id="queryVisits" style="margin:10px;">Show visitors</a>
        </div>
      </form>
    </div>
  </body>